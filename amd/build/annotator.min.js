define(["jquery","jqueryui","core/config","core/str","core/notification"],function(a,b,c,d,e){"use strict";function f(){var b=a.Deferred(),d={mode:a("#block_annotations-form-mode").val(),objectid:a("#block_annotations-form-objectid").val(),objecttype:a("#block_annotations-form-objecttype").val(),text:a("#block_annotations-form-text").val(),courseid:a("#block_annotations-form-courseid").val(),sesskey:c.sesskey},e={type:"POST",dataType:"json",data:d};return a.ajax(k,e).done(function(){b.resolve()}),b}function g(a,b,c){a.append('<div class="annotations"><span data-objecttype="'+b+'" data-objectid="'+c+'" class="btn">'+l+"</span></div>")}function h(){a(".annotations span.btn").click(function(){a("#block_annotations-form-objectid").val(a(this).attr("data-objectid")),a("#block_annotations-form-objecttype").val(a(this).attr("data-objecttype")),j.dialog("open")})}function i(b,c){d.get_string("view","block_annotations").done(function(a){l=a}).fail(e.exception),d.get_string("save","block_annotations").done(function(a){m=a}).fail(m="save"),d.get_string("cancel","block_annotations").done(function(a){n=a}).fail(n="cancel"),d.get_string("close","block_annotations").done(function(a){o=a}).fail(o="close"),p=b;var g="add";a("body").append('<div id="block_annotations-form" title="Create annotation"><form><fieldset><input id="block_annotations-form-mode" type="hidden" name="mode" value="'+g+'"/><input id="block_annotations-form-objectid" type="hidden" name="objectid" value=""/><input id="block_annotations-form-objecttype" type="hidden" name="objecttype" value=""/><input id="block_annotations-form-courseid" type="hidden" name="courseid" value="'+c+'"/><label for="annotation">Annotation</label><textarea name="text" id="block_annotations-form-text" class="text ui-widget-content ui-corner-all" style="width: 300px; height: 150px;"></textarea><input type="submit" tabindex="-1" style="position:absolute; top:-1000px"></fieldset></form></div>'),j=a("#block_annotations-form").dialog({autoOpen:!1,height:400,width:350,modal:!0,buttons:[{text:m,click:f},{text:n,click:function(){j.dialog("close")}}],close:function(){j.find("form")[0].reset()}})}var j,k=c.wwwroot+"/blocks/annotations/annotate.php",l="",m="",n="",o="",p="";return{add:g,init:i,run:h}});