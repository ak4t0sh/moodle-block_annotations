define(["jquery","jqueryui","core/config","core/str","core/notification"],function(a,b,c,d,e){"use strict";function f(){var b=a.Deferred(),d={mode:a("#block_annotations-form-mode").val(),id:a("#block_annotations-form-id").val(),objectid:a("#block_annotations-form-objectid").val(),objecttype:a("#block_annotations-form-objecttype").val(),text:a("#block_annotations-form-text").val(),courseid:a("#block_annotations-form-courseid").val(),sesskey:c.sesskey},e={type:"POST",dataType:"json",data:d};return a.ajax(l,e).done(function(){b.resolve()}),b}function g(a,b,c){var d="",e=b+"_"+c,f=n;e in j&&(d='data-id="'+j[e].id+'"',f=m),a.append('<div class="annotations"><span data-objecttype="'+b+'" data-objectid="'+c+'" '+d+' class="btn">'+f+"</span></div>")}function h(){a(".annotations span.btn").click(function(){var b=a(this).attr("data-id");if("undefined"!=typeof b&&b!==!1&&0!==b.lenght){var c=a(this).attr("data-objecttype")+"_"+a(this).attr("data-objectid");a("#block_annotations-form-id").val(b),a("#block_annotations-form-text").val(j[c].text),a("#block_annotations-form-mode").val("edit")}else a("#block_annotations-form-mode").val("add");a("#block_annotations-form-objectid").val(a(this).attr("data-objectid")),a("#block_annotations-form-objecttype").val(a(this).attr("data-objecttype")),k.dialog("open")})}function i(b,c){j=b,d.get_string("view","block_annotations").done(function(a){m=a}).fail(e.exception),d.get_string("save","block_annotations").done(function(a){o=a}).fail(o="save"),d.get_string("cancel","block_annotations").done(function(a){p=a}).fail(p="cancel"),d.get_string("close","block_annotations").done(function(a){q=a}).fail(q="close"),a("body").append('<div id="block_annotations-form" title="Create annotation"><form><fieldset><input id="block_annotations-form-mode" type="hidden" name="mode" value=""/><input id="block_annotations-form-id" type="hidden" name="id" value=""/><input id="block_annotations-form-objectid" type="hidden" name="objectid" value=""/><input id="block_annotations-form-objecttype" type="hidden" name="objecttype" value=""/><input id="block_annotations-form-courseid" type="hidden" name="courseid" value="'+c+'"/><label for="annotation">Annotation</label><textarea name="text" id="block_annotations-form-text" class="text ui-widget-content ui-corner-all" style="width: 300px; height: 150px;"></textarea><input type="submit" tabindex="-1" style="position:absolute; top:-1000px"></fieldset></form></div>'),k=a("#block_annotations-form").dialog({autoOpen:!1,height:400,width:350,modal:!0,buttons:[{text:o,click:f},{text:p,click:function(){k.dialog("close")}}],close:function(){k.find("form")[0].reset(),a("#block_annotations-form-text").val("")}})}var j,k,l=c.wwwroot+"/blocks/annotations/annotate.php",m="view",n="add",o="save",p="cancel",q="close";return{add:g,init:i,run:h}});